<div [@routerTransition]>
    <!-- <sub-header [title]="'Products' | localize" [description]="">
        <div role="actions">
            <button (click)="exportToExcel()" class="btn btn-outline btn-outline-success btn-active-light-success me-1">
                <i class="fa fa-file-excel"></i>
                {{ l('ExportToExcel') }}
            </button>

            <button *ngIf="isGranted('Pages.Products.Create')" (click)="createProduct()" class="btn btn-primary blue">
                <i class="fa fa-plus"></i>
                {{ l('Product') }}
            </button>
        </div>
    </sub-header> -->

    <div class="w-100 d-flex mb-6 ps-9 pe-9 mt-6 justify-content-between align-items-center ng-tns-c282-7">
        <div class="d-flex">
            <h1 class="fs-3 fw-bold  my-0 page-heading text-dark">
                Product Library
            </h1>
            <span style="cursor: pointer;" class="badge badge-primary badge ms-2">
                Total: {{primengTableHelper.totalRecordsCount}}
            </span>
        </div>
        <button *ngIf="isGranted('Pages.Products.Create')" (click)="createProduct()" class="btn btn-primary blue">
            <i class="fa fa-plus"></i>
            {{ l('Product Library') }}
        </button>
    </div>

    <div [class]="containerClass">
        <div class="card card-custom gutter-b">
            <div class="card-body">
                <form class="form" autocomplete="off">
                    <div>
                        <div class="row align-items-center">
                            <div class="col-xl-12">
                                <div class="my-3">
                                    <div class="input-group mb-3">
                                        <input [(ngModel)]="filterText" (ngModelChange)="getProducts()"
                                            name="filterText" autoFocus type="text" class="form-control"
                                            [placeholder]="l('SearchWithThreeDot')" />
                                        <button class="btn btn-primary" type="submit" (click)="getProducts()">
                                            <i class="flaticon-search-1"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xl-4">
                                <div class="w-100">
                                    <div class="p_filter my-5 d-grid">
                                        <label class="form-label" for="ProductCategoryNameFilter">
                                            Product Category
                                        </label>
                                        <p-dropdown name="productCategoryidFilter" [showClear]="true"
                                            id="productCategoryidFilter" placeholder="Select Category"
                                            [options]="productCategoryOptions" filter="true" optionValue="id"
                                            optionLabel="displayName" (onChange)="onProductCategoryChange($event)">
                                        </p-dropdown>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- <div class="row" [hidden]="!advancedFiltersAreShown">
                            <div class="col-md-12"></div>

                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="IsPublishedFilterSelect">
                                        Published
                                    </label>
                                    <select class="form-select" name="IsPublishedFilter" id="IsPublishedFilterSelect"
                                        [(ngModel)]="isPublishedFilter" (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="MinRegularPriceFilter">
                                        Regular Price
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="MinRegularPriceFilter"
                                            [(ngModel)]="minRegularPriceFilter" placeholder="Min Price"
                                            name="minRegularPriceFilter" (ngModelChange)="getProducts()" />
                                        <input type="number" class="form-control" [(ngModel)]="maxRegularPriceFilter"
                                            placeholder="Max Price" name="maxRegularPriceFilter"
                                            (ngModelChange)="getProducts()" />
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="MinSalePriceFilter">
                                        Sale Price
                                    </label>
                                    <div class="input-group">
                                        <input type="number" class="form-control" id="MinSalePriceFilter"
                                            [(ngModel)]="minSalesPriceFilter" placeholder="Min Price"
                                            name="minSalePriceFilter" (ngModelChange)="getProducts()" />
                                        <input type="number" class="form-control" [(ngModel)]="maxSalesPriceFilter"
                                            placeholder="Max Price" name="maxSalePriceFilter"
                                            (ngModelChange)="getProducts()" />
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="CallForPriceFilterSelect">
                                        {{ l('Call for Price') }}
                                    </label>
                                    <select class="form-select" name="CallForPriceFilter" id="CallForPriceFilterSelect"
                                        [(ngModel)]="callForPriceFilter" (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="IsDisplayStockQuantityFilterSelect">
                                        {{ l('Display Stock Quantity') }}
                                    </label>
                                    <select class="form-select" name="IsDisplayStockQuantityFilter"
                                        id="IsDisplayStockQuantityFilterSelect"
                                        [(ngModel)]="isDisplayStockQuantityFilter" (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>

                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="IsPackageProductFilterSelect">
                                        {{ l('Package Product') }}
                                    </label>
                                    <select class="form-select" name="IsPackageProductFilter"
                                        id="IsPackageProductFilterSelect" [(ngModel)]="isPackageProductFilter"
                                        (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="IsServiceFilterSelect">{{ l('Service') }}</label>
                                    <select class="form-select" name="IsServiceFilter" id="IsServiceFilterSelect"
                                        [(ngModel)]="isServiceFilter" (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="my-3">
                                    <label class="form-label" for="IsWholeSaleProductFilterSelect">
                                        {{ l('Whole Sale Product') }}
                                    </label>
                                    <select class="form-select" name="IsWholeSaleProductFilter"
                                        id="IsWholeSaleProductFilterSelect" [(ngModel)]="isWholeSaleProductFilter"
                                        (ngModelChange)="getProducts()">
                                        <option value="-1">{{ l('All') }}</option>
                                        <option value="0">{{ l('No') }}</option>
                                        <option value="1">{{ l('Yes') }}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-12 mt-5">
                                <button (click)="resetFilters()" class="btn btn-secondary btn-sm"
                                    id="btn-reset-filters">
                                    Reset
                                </button>
                            </div>
                        </div>
                        <div class="row my-4">
                            <div class="col-sm-12">
                                <span class="clickable-item text-muted" *ngIf="!advancedFiltersAreShown"
                                    (click)="advancedFiltersAreShown = !advancedFiltersAreShown">
                                    <i class="fa fa-angle-down"></i>
                                    {{ l('ShowAdvancedFilters') }}
                                </span>
                                <span class="clickable-item text-muted" *ngIf="advancedFiltersAreShown"
                                    (click)="advancedFiltersAreShown = !advancedFiltersAreShown">
                                    <i class="fa fa-angle-up"></i>
                                    {{ l('HideAdvancedFilters') }}
                                </span>
                            </div>
                        </div> -->
                    </div>
                </form>

                <div class="row align-items-center">
                    <!--<Primeng-Datatable-Start>-->
                    <div class="primeng-datatable-container col-12" [busyIf]="primengTableHelper.isLoading">
                        <p-table #dataTable (onLazyLoad)="getProducts($event)" [value]="primengTableHelper.records"
                            rows="{{primengTableHelper.defaultRecordsCountPerPage}}" [paginator]="false"
                            [lazy]="true" [scrollable]="true" ScrollWidth="100%"
                            [responsive]="primengTableHelper.isResponsive"
                            [resizableColumns]="primengTableHelper.resizableColumns">
                            <ng-template pTemplate="header">
                                <tr>
                                    <th style="width: 90px">
                                        {{l('Category')}}
                                    </th>
                                    <th style="width: 110px">
                                        {{l('No. of Product')}}
                                    </th>
                                </tr>
                            </ng-template>
                            <ng-template pTemplate="body" let-record="$implicit">
                                <tr>
                                    <td style="width:90px">
                                        <div class="d-flex">
                                            <div class="custom_caccordion_pr d-flex align-items-center"
                                                (click)="onCategoryClick(record.categoryId)">
                                                <i *ngIf="record.categoryId!=productCategoryId"
                                                    class="la la-angle-right"></i>
                                                <i *ngIf="record.categoryId==productCategoryId"
                                                    class="la la-angle-down"></i>
                                            </div>
                                            <div class="d-flex main_box">
                                                <div class="mr-3 cat__p_img">
                                                    <img class="pro__img-p shadow-sm"
                                                        src="{{record.picture != null?record.picture:'/assets/common/images/sampleProfilePics/noimg.png'}}"
                                                        alt="image">
                                                </div>
                                                <div>
                                                    <a href="javascript:;"
                                                        class="product_link">{{record.categoryName}}</a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td style="width: 110px;">
                                        {{record.numberOfProducts}}
                                    </td>
                                </tr>

                                <tr *ngIf="record.categoryId == productCategoryId">
                                    <td style="background: white;" colspan="2">
                                        <div class="card-body">
                                            <app-category-wise-product-template [categoryId]="record.categoryId">
                                            </app-category-wise-product-template>
                                        </div>
                                    </td>
                                </tr>
                            </ng-template>
                        </p-table>
                        <div class="primeng-no-data" *ngIf="primengTableHelper.totalRecordsCount == 0">
                            {{l('NoData')}}
                        </div>
                        <div class="primeng-paging-container">
                            <p-paginator [rows]="primengTableHelper.defaultRecordsCountPerPage" #paginator
                                (onPageChange)="getProducts($event)"
                                [totalRecords]="primengTableHelper.totalRecordsCount"
                                [rowsPerPageOptions]="primengTableHelper.predefinedRecordsCountPerPage">
                            </p-paginator>

                        </div>
                    </div>
                    <!--<Primeng-Datatable-End>-->
                </div>
            </div>
        </div>
    </div>
    <createOrEditProductModal #createOrEditProductModal (modalSave)="getProducts()"></createOrEditProductModal>
    <viewProductModal #viewProductModal></viewProductModal>
</div>